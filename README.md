## О проекте

Приложение представляет собой REST-сервис для получения и отображения курсов валют, загружаемых с сайта Центрального банка РФ.  
При запуске выполняется начальное наполнение базы данных: происходит парсинг официальных страниц ЦБ за период с **01.10.2025** по **текущую дату**.  
После этого активируется планировщик (`CurrencyScheduler`), который автоматически обновляет курсы валют (настроено раз в 4 минуты для демо-проверки, вообще - раз в сутки)



### Логика работы

1. При старте приложения происходит сбор исторических данных о курсах валют. Даты обрабатываюся в отдельных потоках.  
2. После загрузки данных выполняется расчет разницы (`dailyChange`) между курсами за два "соседних" дня
3. Планировщик автоматически вызывает обновление данных по расписанию.  
4. Доступ к данным возможен через REST API (`/answer`, `/answer/main`) или через HTML-интерфейс (`/view...`).

### Запуск (проверено в IntelliJ IDEA)

1. Собрать и запустить проект
2. В консоли будет сообщено о процессе парсинга и последующего обновления данных  
3. Открыть браузер и перейти по адресу: 
   ```
   http://127.0.0.1:8000/answer
   ```
   или воспользоваться инструментом **Postman** для выполнения POST-запросов

Также построены unit-тесты для ядра бекэнда - `tests/DemoApplicationTests`
Проверяется работа сервисных классов по заполнению БД (`CurrencyCollectorService`) и выполнению запросов (`CurrencyQueryService`)

## POST-Эндпоинты (`Controller`)

### POST /answer

Возвращает записи из базы данных.  
Параметры передаются в теле запроса в формате JSON.

Поддерживаемые параметры:
- date - дата в формате YYYY-MM-DD  
- currencyCodes - список кодов валют (список строк)  
- sortBy - поле сортировки (date, code, exchangeRate)  
- ascending — направление сортировки (true или false)

#### Примеры запросов для /answer (проверено в Postman)

URL: http://127.0.0.1:8000/answer

1. Без параметров (все записи, сортировка по дате по возрастанию):
```json
{}
```

2. Все записи, сортировка по дате по убыванию:
```json
{
  "sortBy": "date",
  "ascending": false
}
```

3. Все записи, сортировка по коду валюты:
```json
{
  "sortBy": "code",
  "ascending": true
}
```

4. Курсы на конкретную дату (2025-11-02):
```json
{
  "date": "2025-11-02"
}
```

5. Курсы на дату с сортировкой по курсу по убыванию:
```json
{
  "date": "2025-10-02",
  "sortBy": "exchangeRate",
  "ascending": false
}
```

6. Курсы на дату только для USD, EUR, CNY:
```json
{
  "date": "2025-10-02",
  "currencyCodes": ["USD", "EUR", "CNY"]
}
```

7. Курсы только для USD, сортировка по дате:
```json
{
  "currencyCodes": ["USD"],
  "sortBy": "date",
  "ascending": true
}
```

### POST /answer/main

Возвращает курсы пяти основных валют: EUR, USD, CNY, GBP, CHF.
Можно задавать дату и параметры сортировки.

Поддерживаемые параметры:
- date - дата в формате YYYY-MM-DD
- sortBy — поле сортировки (code, date, exchangeRate, difference)
- ascending — направление сортировки (true или false)

#### Примеры запросов для /answer/main (проверено в Postman)

URL: http://127.0.0.1:8000/answer/main

8. Все основные валюты без параметров:
```json
{}
```

9. Основные валюты на конкретную дату (2025-10-02)
```json
{
  "date": "2025-10-02"
}
```

10. Основные валюты, сортировка по курсу по убыванию:
```json
{
  "sortBy": "exchangeRate",
  "ascending": false
}
```

## GET-эндпоинты (`Controller`)

### GET /answer 

Возвращает JSON-результат выборки из базы данных.  
Параметры передаются в URL в виде query-параметров.

Поддерживаемые параметры:
- date - дата в формате YYYY-MM-DD  
- codes - список кодов валют (например, codes=USD,EUR,CNY)  
- sortBy - поле сортировки (date, code, exchangeRate)  
- asc - направление сортировки (true или false)

#### Примеры запросов для /answer

1. Все записи:
```
http://127.0.0.1:8000/answer
```

2. Все записи, сортировка по коду валюты:
```
http://127.0.0.1:8000/answer?sortBy=code&asc=true
```

3. Все записи, сортировка по дате по убыванию:
```
http://127.0.0.1:8000/answer?sortBy=date&asc=false
```

4. Курсы на конкретную дату:
```
http://127.0.0.1:8000/answer?date=2025-10-02
```

5. Курсы на дату для конкретных валют:
```
http://127.0.0.1:8000/answer?date=2025-10-02&codes=USD,EUR,CNY
```

6. Курсы только для USD, сортировка по дате:
```
http://127.0.0.1:8000/answer?codes=USD&sortBy=date&asc=true
```

---

### GET /answer/main

Возвращает JSON для пяти основных валют: EUR, USD, CNY, GBP, CHF.  
Можно задавать дату и параметры сортировки.

Поддерживаемые параметры:
- date - дата в формате YYYY-MM-DD  
- sortBy - поле сортировки (code, date, exchangeRate, difference)  
- asc - направление сортировки (true или false)

#### Примеры запросов для /answer/main

1. Все основные валюты:
```
http://127.0.0.1:8000/answer/main
```

2. Основные валюты на конкретную дату:
```
http://127.0.0.1:8000/answer/main?date=2025-10-02
```

3. Основные валюты, сортировка по курсу по убыванию:
```
http://127.0.0.1:8000/answer/main?sortBy=exchangeRate&asc=false
```

---

## Веб-представления (HTML-страницы - `CurrencyViewController`)

Для наглядного представления данных добавлены простые страницы с таблицей и пагинацией.  
HTML-шаблоны расположены в папке `templates`.

### GET /view

Отображает данные из БД в виде таблицы.  
Параметры аналогичны эндпоинту `/answer`.

#### Примеры запросов для /view

1. Все записи:
```
http://127.0.0.1:8000/view
```

2. Все записи, сортировка по коду валюты:
```
http://127.0.0.1:8000/view?sortBy=code&asc=true
```

3. Все записи, сортировка по дате по убыванию:
```
http://127.0.0.1:8000/view?sortBy=date&asc=false
```

4. Курсы на конкретную дату:
```
http://127.0.0.1:8000/view?date=2025-10-02
```

5. Курсы на дату для конкретных валют:
```
http://127.0.0.1:8000/view?date=2025-10-02&codes=USD,EUR,CNY
```

6. Курсы только для USD, сортировка по дате:
```
http://127.0.0.1:8000/view?codes=USD&sortBy=date&asc=true
```

---

### GET /view/main

Отображает курсы пяти основных валют (EUR, USD, CNY, GBP, CHF) в таблице.  
Параметры аналогичны эндпоинту `/answer/main`.

#### Примеры запросов для /view/main

1. Все основные валюты:
```
http://127.0.0.1:8000/view/main
```

2. Основные валюты на конкретную дату:
```
http://127.0.0.1:8000/view/main?date=2025-10-02
```

3. Основные валюты, сортировка по курсу по убыванию:
```
http://127.0.0.1:8000/view/main?sortBy=exchangeRate&asc=false
```
